<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Сервера | Nox73 Home</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,700,300,600,800&subset=cyrillic,cyrillic-ext,latin,latin-ext' rel='stylesheet' type='text/css'>
  <meta name="generator" content="Nox73 Home">
  <script src="http://static.duoshuo.com/embed.js"></script>
  
  
  <link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="atom.xml">
  
  

  

</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2014/11/30/servers/">Сервера</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2014/11/30/servers/">Сервера</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2014/11/28/hello-world/">Hello World</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/web/">&nbsp;&nbsp;&nbsp;web</a>
                                    <small>2</small>
                                </li>
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/web-base/">&nbsp;&nbsp;&nbsp;web, base</a>
                                    <small>0</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li class="mp-pjax"><a class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <!-- <li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li> -->

                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/2014/11/30/servers/">Сервера</a>
                
                    <a  data-pjax href="/2014/11/30/servers/">Сервера</a>
                
                    <a  data-pjax href="/2014/11/28/hello-world/">Hello World</a>
                
                
                
                    <a data-pjax href="/tags/web/">&nbsp;&nbsp;web</a>
                
                    <a data-pjax href="/tags/web-base/">&nbsp;&nbsp;web, base</a>
                
                <a data-pjax class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" data-pjax href="/"><i class="fa fa-home top-home-icon"></i></a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">Сервера</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                      
                      <a data-pjax href='/tags/web/' style='color:#D5D5D5'>web</a>
                      
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">Сервера</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2014-11-29T20:00:00.000Z"
                              itemprop="datePublished">30 Nov 2014</time>
                    </div>
    </span>

        <section class="post-content">
            <p>Как устроены сервера обработки запросов. Упражнение в передачи мыслей на расстоянии.</p>
<a id="more"></a>

<h2 id="Запрос">Запрос</h2>
<p>Жизненный цикл запроса примерно такой:</p>
<ul>
<li><strong>Ожидание</strong> запрос может проводить как в очереди, организованной на стороне сервера, так и просто ожидая установки соединения.</li>
<li><strong>Прием</strong> подразумевает считывание содержимого запроса.</li>
<li><strong>Исполнение</strong>. В это время задача может находится в нескольких состояниях:<ul>
<li>выполняется - означает что потребляется CPU</li>
<li>ожидает события - операция ввода/вывода, таймер …</li>
<li>приостановлена - по какой-то причине была остановлена и ожидает возобновления исполнения</li>
</ul>
</li>
<li><strong>Ответ</strong> — посылка содержимого ответа.</li>
</ul>
<h2 id="Очередь_запросов">Очередь запросов</h2>
<p>Как обрабатывать запросы?</p>
<h5 id="→_→_Последовательно">→ → Последовательно</h5>
<p>Каждый запрос обрабатывается последовательно, один за другим.</p>
<h5 id="⇒_⇒_Параллельно">⇒ ⇒ Параллельно</h5>
<p>На каждый запрос запускается нить, которая будет его обрабатывать.</p>
<h5 id="…_…_Конкурентно">… … Конкурентно</h5>
<p>Все запросы обрабатываются в одной нити, но она постоянно переключается<br>между запросами не дожидаясь окончания обработки запроса.</p>
<h2 id="Последовательная_обработка">Последовательная обработка</h2>
<p>Нить получает запрос, обрабатывает, отдает ответ. Все просто.</p>
<p>Проблемы возникают когда в процессе обработки запроса необходимо сделать что-то, что требует ожидания. Например, нужно сходить на диск и прочитать файл. Либо сделать длительный запрос в базу данных. Все остальные запросы в таком случае будут просто стоять в очереди.</p>
<p>Если же на обработку запроса нет необходимости выполнять длительные операции (в том числе на получение запроса и отправку ответа), то такая схема обрабоки вполне может применяться.</p>
<p>Чаще всего подобные схемы используют в качестве единицы обработки запроса процесс.</p>
<h2 id="Параллельная_обработка">Параллельная обработка</h2>
<p>Основная нить при поступлении запроса создает дополнительную, которая будет заниматься его обработкой.</p>
<p>Преимущества такого подхода очевидны — все запросы обрабатываются одновременно, используются все вычислительные ресурсы процессора.</p>
<p>В качестве единицы обработки могут использоваться как процессы, так и потоки операционной системы.</p>
<p>Основной проблемой данного подхода является случай с одновременной обработкой большого количества запросов. Каждый новый процесс или поток привносит накладные расходы на переключение контекстов, увеличивается нагрузка на планировщик операционной системы, требуется выделение памяти под стек.</p>
<p>Запуск нового процесса/потока также может занимать значительное время.</p>
<h5 id="Пул">Пул</h5>
<p>Часто со схемой параллельной обрабоки используется пул. Пул обработчиков запроса — заранее запущенные процессы или потоки (workers), получающие задание на обработку запроса.</p>
<p>Запросы при этом выстраиваются в очередь и ждут когда свободный worker их обработает.</p>
<p>Пул может быть как статичный (неизменное кол-во воркеров), так и динамичный, при котором количество воркеров меняется в зависимости от длины очереди или других параметров.</p>
<p>Пул решает проблему ограничения нагрузки на сервер. Уменьшает время на обработку запроса, нет необходимости запускать новый процесс при поступлении запроса.</p>
<h2 id="Конкурентная_обработка">Конкурентная обработка</h2>
<p>Не стоит путать с параллельностью.</p>
<p>При конкурентной обработке, в отличии от параллельной, нет необходимости в нескольких нитях или воркерах. Данный вид предусматривает наличие механизма переключения задачи, даже если текущая еще не была закончена.</p>
<h5 id="Вытеснение">Вытеснение</h5>
<p>Переключение между обрабатываемыми запросами (или говоря по-другому задачами), происходит за счет вытеснения исполняемой задачи без ее участия. Т.е. исполняемая задача не знает в какой момент времени она может быть прервана и не может отменить или повлиять на это.  Подобный способ переключения подразумевает наличие специального механизма вытеснения.</p>
<p>Примером вытесняющей многозадачности могут служить потоки операционной системы. По истечению определенного времени в процессор генерируется прерывание которое запускает  обработчик прерывания из ОС. В нем OC может решить, должен ли текущий поток продолжить выполнение, или его можно заменить на другой.</p>
<h5 id="Кооперация">Кооперация</h5>
<p>Вид переключения задач, при котором исполняемая задача сама сообщает что может передать управление планировщику задач или непосредственно другой задаче. Данное решение задача может принять либо на основании времени своего выполнения, либо попав в ситуацию, где она должна ждать наступления события (ввод/вывод, таймер и пр.).</p>
<h2 id="Итак">Итак</h2>
<h5 id="Последовательно">Последовательно</h5>
<p>+ простота реализации<br>- все следующие запросы должны ждать окончания предыдущих, возрастает время ожидания в очереди, задача может просто не дождаться<br>- используется только один процессор</p>
<h5 id="Параллельно">Параллельно</h5>
<p>+ каждая задача начинает исполняться сразу (low latency)<br>+ использование всех процессоров<br>- сложнее регулировать нагрузку<br>- сложно обрабатывать запросы с общими данными (реалтайм игры, in memory бд …)<br>- требовательность к ресурсам</p>
<h5 id="Конкурентно">Конкурентно</h5>
<p>+ каждая задача начинает исполняться почти сразу (время на переключение задач, low latency)<br>+ меньше накладных расходов на одновременную обработку<br>- использование только одного процессора</p>
<h2 id="Практика">Практика</h2>
<ul>
<li>чисто последовательная схема практически не используется</li>
<li>паралельная используется только с пулом</li>
<li>конкурентная очень часто используется с паралельной и пулом, где пул воркеров, каждый переключается между несколькими задачами</li>
</ul>

        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a data-pjax class="newer-posts" href="/2014/11/28/hello-world/">← Prev Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
            <a data-pjax class="older-posts" href="/2014/11/30/servers/">Next Post →</a>
            
        </nav>
        <br/>
        <br/>
        <section id="disqus_thread">
            
            <script type="text/javascript">
                var disqus_shortname = 'nox73';

                (function(){
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                }());
            </script>
            
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <a class="subscribe icon-feed" href="atom.xml"><span class="tooltip">Subscribe!</span></a>
    
    <div class="inner">
        <section class="copyright"><a href="/"></a> &copy; Nox73 Home 2014</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>
    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>
  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/js/lib.js"></script>
<script type="text/javascript" src="/js/main.js"></script>



<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-57201900-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>


<script type="text/javascript">
    var disqus_shortname = 'nox73';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
