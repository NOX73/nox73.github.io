<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Nox73 Home]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://nox73.ru/"/>
  <updated>2014-11-29T22:09:20.025Z</updated>
  <id>http://nox73.ru/</id>
  
  <author>
    <name><![CDATA[Alexander nox73 Rozhnov]]></name>
    <email><![CDATA[gnox73@gmail.com]]></email>
  </author>
  
  <generator uri="http://zespia.tw/hexo/">Hexo</generator>
  
  <entry>
    <title><![CDATA[Сервера]]></title>
    <link href="http://nox73.ru/2014/11/30/servers/"/>
    <id>http://nox73.ru/2014/11/30/servers/</id>
    <published>2014-11-29T20:00:00.000Z</published>
    <updated>2014-11-29T22:03:59.000Z</updated>
    <content type="html"><![CDATA[<p>Как устроены сервера обработки запросов. Упражнение в передачи мыслей на расстоянии.</p>
<a id="more"></a>

<h2 id="Запрос">Запрос</h2>
<p>Жизненный цикл запроса примерно такой:</p>
<ul>
<li><strong>Ожидание</strong> запрос может проводить как в очереди, организованной на стороне сервера, так и просто ожидая установки соединения.</li>
<li><strong>Прием</strong> подразумевает считывание содержимого запроса.</li>
<li><strong>Исполнение</strong>. В это время задача может находится в нескольких состояниях:<ul>
<li>выполняется - означает что потребляется CPU</li>
<li>ожидает события - операция ввода/вывода, таймер …</li>
<li>приостановлена - по какой-то причине была остановлена и ожидает возобновления исполнения</li>
</ul>
</li>
<li><strong>Ответ</strong> — посылка содержимого ответа.</li>
</ul>
<h2 id="Очередь_запросов">Очередь запросов</h2>
<p>Как обрабатывать запросы?</p>
<h5 id="→_→_Последовательно">→ → Последовательно</h5>
<p>Каждый запрос обрабатывается последовательно, один за другим.</p>
<h5 id="⇒_⇒_Параллельно">⇒ ⇒ Параллельно</h5>
<p>На каждый запрос запускается нить, которая будет его обрабатывать.</p>
<h5 id="…_…_Конкурентно">… … Конкурентно</h5>
<p>Все запросы обрабатываются в одной нити, но она постоянно переключается<br>между запросами не дожидаясь окончания обработки каждого.</p>
<h2 id="Последовательная_обработка">Последовательная обработка</h2>
<p>Нить получает запрос, обрабатывает, отдает ответ. Все просто.</p>
<p>Проблемы возникают когда в процессе обработки запроса необходимо сделать что-то, что требует ожидания. Например, нужно сходить на диск и прочитать файл. Либо сделать длительный запрос в базу данных. Все остальные запросы в таком случае будут просто стоять в очереди.</p>
<p>Если же на обработку запроса нет необходимости выполнять длительные операции (в том числе на получение запроса и отправку ответа), то такая схема обрабоки вполне может применяться.</p>
<p>Чаще всего подобные схемы используют в качестве единицы обработки запроса процесс.</p>
<h2 id="Параллельная_обработка">Параллельная обработка</h2>
<p>Основная нить при поступлении запроса создает дополнительную, которая будет заниматься его обработкой.</p>
<p>Преимущества такого подхода очевидны — все запросы обрабатываются одновременно, используются все вычислительные ресурсы процессора.</p>
<p>В качестве единицы обработки могут использоваться как процессы, так и потоки операционной системы.</p>
<p>Основной проблемой данного подхода является случай с одновременной обработкой большого количества запросов. Каждый новый процесс или поток привносит накладные расходы на переключение контекстов, увеличивается нагрузка на планировщик операционной системы, требуется выделение памяти под стек.</p>
<p>Запуск нового процесса/потока также может занимать значительное время.</p>
<h5 id="Пул">Пул</h5>
<p>Часто со схемой параллельной обрабоки используется пул. Пул обработчиков запроса — заранее запущенные процессы или потоки (workers), получающие задание на обработку запроса.</p>
<p>Запросы при этом выстраиваются в очередь и ждут когда свободный worker их обработает.</p>
<p>Пул может быть как статичный (неизменное кол-во воркеров), так и динамичный, при котором количество воркеров меняется в зависимости от длины очереди или других параметров.</p>
<p>Пул решает проблему ограничения нагрузки на сервер. Уменьшает время на обработку запроса, нет необходимости запускать новый процесс при поступлении запроса.</p>
<h2 id="Конкурентная_обработка">Конкурентная обработка</h2>
<p>Не стоит путать с параллельностью.</p>
<p>При конкурентной обработке, в отличии от параллельной, нет необходимости в нескольких нитях или воркерах. Данный вид предусматривает наличие механизма переключения задачи, даже если текущая еще не была закончена.</p>
<h5 id="Вытеснение">Вытеснение</h5>
<p>Переключение между обрабатываемыми запросами (или говоря по-другому задачами), происходит за счет вытеснения исполняемой задачи без ее участия. Т.е. исполняемая задача не знает в какой момент времени она может быть прервана и не может отменить или повлиять на это.  Подобный способ переключения подразумевает наличие специального механизма вытеснения.</p>
<p>Примером вытесняющей многозадачности могут служить потоки операционной системы. По истечению определенного времени в процессор генерируется прерывание которое запускает  обработчик прерывания из ОС. В нем OC может решить, должен ли текущий поток продолжить выполнение, или его можно заменить на другой.</p>
<h5 id="Кооперация">Кооперация</h5>
<p>Вид переключения задач, при котором исполняемая задача сама сообщает что может передать управление планировщику задач или непосредственно другой задаче. Данное решение задача может принять либо на основании времени своего выполнения, либо попав в ситуацию, где она должна ждать наступления события (ввод/вывод, таймер и пр.).</p>
<h2 id="Итак">Итак</h2>
<h5 id="Последовательно">Последовательно</h5>
<p>+ простота реализации<br>- все следующие запросы должны ждать окончания предыдущих, возрастает время ожидания в очереди, задача может просто не дождаться<br>- используется только один процессор</p>
<h5 id="Параллельно">Параллельно</h5>
<p>+ каждая задача начинает исполняться сразу (low latency)<br>+ использование всех процессоров<br>- сложнее регулировать нагрузку<br>- сложно обрабатывать запросы с общими данными (реалтайм игры, in memory бд …)<br>- требовательность к ресурсам</p>
<h5 id="Конкурентно">Конкурентно</h5>
<p>+ каждая задача начинает исполняться почти сразу (время на переключение задач, low latency)<br>+ меньше накладных расходов на одновременную обработку<br>- использование только одного процессора</p>
<h2 id="Практика">Практика</h2>
<ul>
<li>чисто последовательная схема практически не используется</li>
<li>паралельная используется только с пулом</li>
<li>конкурентная очень часто используется с паралельной и пулом, где пул воркеров, каждый переключается между несколькими задачами</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>Как устроены сервера обработки запросов. Упражнение в передачи мыслей на расстоянии.</p>
]]>
    
    </summary>
    
      <category term="web" scheme="http://nox73.ru/tags/web/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello World]]></title>
    <link href="http://nox73.ru/2014/11/28/hello-world/"/>
    <id>http://nox73.ru/2014/11/28/hello-world/</id>
    <published>2014-11-27T20:00:00.000Z</published>
    <updated>2014-11-29T19:17:54.000Z</updated>
    <content type="html"><![CDATA[<h4 id="Первая_запись!">Первая запись!</h4>
<a id="more"></a>

<p>Постараюсь чтобы она была не последняя.</p>
<p>Долго выбирал на чем запустить блог, выбрал <a href="http://hexo.io" target="_blank" rel="external">hexo</a> и <a href="https://github.com/yuche/hexo-theme-kael" target="_blank" rel="external">тему kael</a>. Немного<br>пришлось ее подтюнить. Вроде ничего получилось.</p>
]]></content>
    <summary type="html">
    <![CDATA[<h4 id="Первая_запись!">Первая запись!</h4>
]]>
    
    </summary>
    
  </entry>
  
</feed>
